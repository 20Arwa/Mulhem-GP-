{% extends "base.html" %}
{% block title %}  profile {% endblock %}
{% block styles %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/auth/profile.css') }}">
{% endblock %}
{% block body %}
<div class="profile-container">
    <h1>
        <i class="fa-solid fa-user user-icon"></i>   ملفي الشخصي  </h1>
    
    <!-- نموذج الإدخال -->
    <form class="profile-form" id="profile-form">
        <label for="first-name">
            <i class="fa-solid fa-pen-to-square"></i> الاسم الأول :</label>
        <input type="text" id="first-name" maxlength="9" placeholder="جولي ">

        <label for="last-name">
            <i class="fa-solid fa-pen-to-square"></i> الاسم الأخير : </label>
        <input type="text" id="last-name" maxlength="10" placeholder=" الزهراني">

        <label for="age">
            <i class="fa-solid fa-calendar"></i> العمر : </label>
        <input type="number" id="age" min="8" max="12" placeholder=" 9">

        <label for="gender">
            <i class="fa-solid fa-venus-mars"></i> الجنس : </label>
        <input type="text" id="gender" maxlength="4" placeholder="أنثى">

        <label for="email">
            <i class="fa-solid fa-envelope"></i> الإيميل : </label>
        <input type="email" id="email" placeholder=" LOOD@gmail.com ">

        <label for="password">
            <i class="fa-solid fa-lock"></i> كلمة المرور : </label>
        <input type="password" id="password" maxlength="12" placeholder="***********">

    <div class="save-container">
    <button class="save-button" type="button" id="save-button"> حفظ </button>
    </div>
</form>
<div id="message" style="display:none; color: rgb(94, 218, 94); margin-top: 10px;"></div>
</div>

{% endblock %}
{%block script%}
<script>

document.addEventListener("DOMContentLoaded", () => {
    const userId = 1; // استبدل بـ id الخاص بالمستخدم

    // جلب بيانات المستخدم
    fetch(`/profile/${userId}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                console.error(data.error);
                return;
            }

            // تعبئة الحقول بالبيانات
            document.getElementById("first-name").value = data.first_name;
            document.getElementById("last-name").value = data.last_name;
            document.getElementById("age").value = data.age;
            document.getElementById("gender").value = data.gender;
            document.getElementById("email").value = data.email;
        })
        .catch(error => console.error("Error fetching user data:", error));
});

document.getElementById("save-button").addEventListener("click", () => {
    const userId = 1; // استبدل بـ id الخاص بالمستخدم

    const updatedData = {
        first_name: document.getElementById("first-name").value,
        last_name: document.getElementById("last-name").value,
        age: document.getElementById("age").value,
        gender: document.getElementById("gender").value,
        email: document.getElementById("email").value,
        password: document.getElementById("password").value // تحديث كلمة المرور (اختياري)
    };

    fetch(`/profile/${userId}`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(updatedData)
    })
        .then(response => response.json())
        .then(data => {
            const message = document.getElementById("message");
            if (data.error) {
                message.style.color = "red";
                message.innerText = data.error;
            } else {
                message.style.color = "green";
                message.innerText = data.message;
            }
            message.style.display = "block";
        })
        .catch(error => console.error("Error updating profile:", error));
});

</script>
{%endblock%}

